# アプリケーション設計書：NPB打順シミュレーター


## 1. アプリケーションの目的と概要

* **目的**: NPB（日本プロ野球）の野手成績データに基づき、最も得点効率の良い打順を探索します。
* **作成目的**: **Streamlit**の多様な機能をユーザーに体験してもらい、その可能性を示すデモンストレーションとして機能させます。
* **対象ユーザー**: プロ野球ファン、データ分析に興味がある方、Streamlitの学習者。
* **提供価値**: 実際のデータに基づいた打順シミュレーションを通じて、プロ野球における戦略的な面白さを提供します。また、StreamlitのインタラクティブなUIを体験できます。

---

## 2. 主要機能

データ取得部分、簡易的なゲーム進行ロジックは実装済みです。以下の機能に焦点を当てて設計します。

### 2.1. 年度・チーム選択機能

* **機能概要**: ユーザーがシミュレーション対象とする**年度**と**チーム**を選択できます。選択できる年度とチームはあらかじめ指定します。
* **UI要素 (Streamlit)**:
    * **年度選択**: `st.selectbox` または `st.radio` (選択肢が少ない場合) を使用して、選択可能な年度をリスト表示します。
    * **チーム選択**: `st.selectbox` または `st.radio` を使用して、選択した年度に所属するチームをリスト表示します。
* **データ連携**: 選択された年度とチームに基づき、該当する選手の成績データ（CSVファイル）を読み込み、**Pandas DataFrame**としてメモリ上に保持します。

### 2.2. 任意の打順シミュレーション機能

* **機能概要**: ユーザーが選択したチームの選手を任意に打順に配置し、1試合（9イニング）のシミュレーションを実行します。
* **UI要素 (Streamlit)**:
    * **選手一覧表示**: 選択されたチームの選手リストを**Pandas DataFrame**として表示し、ユーザーが打順に組み込む選手を視覚的に確認できるようにします。
    * **打順入力インターフェース**:
        * `st.selectbox` を1番から9番まで9つ並べ、各打順に選手を割り当てられるようにします。
        * 初期値はデフォルトラインナップです。
        * **同じ選手を複数回選択可能**とします。
    * **シミュレーション実行ボタン**: `st.button` でシミュレーションを開始します。
    * **シミュレーション結果表示**:
        * 試合結果（**最終得点**、**安打数**、**エラー数**など）を`st.metric`などで簡潔に表示します。
        * **イニングごとの詳細なプレイログ**: `st.expander`内に、**打席ごとの結果**（「〇回表：〇〇が三振」「〇回裏：〇〇が二塁打（1打点）」など）を時系列で表示します。結果は「**アウト**」「**一塁打**」「**二塁打**」「**三塁打**」「**本塁打**」で、あれば「**打点数**」も表示します。
        * **打者ごとの成績**: シミュレーション後の各打者の**打席数**、**打数**、**安打数**、**打点**、**打率**などを`st.dataframe`で表示します。
* **シミュレーションロジック**:
    * 各選手の打撃成績（打率、出塁率、長打率など）に基づき、乱数を使用して各打席の結果（ヒット、フォアボール、三振、アウトなど）を決定します。
    * 得点の計算ロジック（ランナーの進塁、本塁打での得点など）を実装します。

### 2.3. 複数回試行による最良打順推定機能

* **機能概要**: ユーザーが指定した回数（例: 1000回）のランダムな打順を生成し、それぞれの打順で**143試合（NPBレギュラーシーズン相当）のシミュレーション**を自動で実行します。その結果に基づいて、**最も平均得点が高かった打順**と**低かった打順**を表示します。
* **UI要素 (Streamlit)**:
    * **試行する打順の数入力**: `st.number_input` または `st.slider` で、ユーザーがランダムに生成する打順の数を指定できるようにします。
    * **推定実行ボタン**: `st.button` で最良打順の推定を開始します。
    * **進捗表示**: 長時間かかる可能性があるため、`st.progress` や `st.spinner` を使用してシミュレーションの進捗状況をユーザーにフィードバックします。
    * **最良打順結果表示**:
        * **最も高い平均得点**を出した打順と、その平均得点、およびその打順での**各選手の詳細成績**（打席数、安打数、打点、打率など）を明確に表示します。
        * **最も低い平均得点**を出した打順と、その平均得点、およびその打順での**各選手の詳細成績**を明確に表示します。
        * 結果の視覚化として、`st.bar_chart`などで得点分布を表示することも検討します。
* **シミュレーションロジック**:
    * 選択されたチームから**重複なく9名の選手を選び**、ランダムな打順を生成します。
    * 生成された各打順に対して、143試合のシミュレーションを実行し、その平均得点を算出します。
    * 将来的に、遺伝的アルゴリズムなどのより効率的な探索アルゴリズムに拡張しやすいようなモジュール構造を意識して実装します。

---

## 3. UI/UXの要件

* **シンプルさ**: 複雑な操作を排除し、直感的に使えるインターフェースを目指します。
* **Streamlitの活用**: サイドバー (`st.sidebar`)、コラム (`st.columns`), エキスパンダー (`st.expander`), プログレスバー (`st.progress`), `st.metric`, `st.dataframe` など、Streamlitの主要なウィジェットやレイアウト機能を積極的に活用し、Streamlitのデモとしても機能させます。
* **レスポンシブデザイン**: PC、タブレット、スマートフォンなど、様々なデバイスからアクセスしてもレイアウトが崩れないように配慮します。
* **視覚的なフィードバック**: シミュレーションの実行中や結果表示時に、ユーザーが状況を把握しやすいように工夫します。

---

## 4. 技術スタック

* **開発言語**: Python
* **主要ライブラリ**:
    * **Streamlit**: UI構築、インタラクティブな要素の実装
    * **Pandas**: 野手成績データの処理、操作
    * **Numpy**: シミュレーションにおける乱数生成、数値計算
* **クラウド環境**:
    * **リポジトリ**: GitHub
    * **デプロイ**: Streamlit Cloud

---

## 5. その他の考慮事項

* **エラー処理・入力検証**: ユーザーが無効な入力（例: 数値以外の入力）をした場合のエラーハンドリングを適切に行います。
* **データ構造**: CSVファイルから読み込んだ選手の成績データは、シミュレーションロジックで利用しやすい形式（例: 各選手IDに紐づく打率、出塁率、長打率などの辞書やPandas DataFrame）に変換して保持します。